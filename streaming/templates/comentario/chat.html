<!DOCTYPE html>
<html>
<head>
  <title>Prueba Comentario WebSocket</title>
</head>
<body>
  <h2>Canal de comentarios (Streaming ID: 1)</h2>

  <label for="idusuario">ID Usuario:</label>
  <input type="number" id="idusuario"><br>

  <label for="comentario">Comentario:</label>
  <input type="text" id="comentario">
  <button onclick="enviarComentario()">Enviar</button>

  <h3>Mensajes recibidos:</h3>
  <ul id="mensajes"></ul>

  <script>
    const idstreaming = 1;
    const socket = new WebSocket(`ws://18.220.9.56/ws/comentarios/${idstreaming}/`);

    socket.onopen = () => {
      console.log("Conectado al canal de comentarios");
    };

    socket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      const li = document.createElement("li");
      li.textContent = `[${data.fecha}] ${data.usuario}: ${data.comentario}`;
      document.getElementById("mensajes").appendChild(li);
    };

    socket.onclose = () => {
      console.log("Conexión cerrada");
    };

  function enviarComentario() {
    const comentario = document.getElementById("comentario").value;
    const idusuario = document.getElementById("idusuario").value;

    if (!comentario.trim()) {
      alert("Comentario vacío");
      return;
    }

    const mensaje = {
      comentario: comentario,
      idusuario: idusuario,
      idstreaming: 1  // canal fijo para pruebas
    };

    socket.send(JSON.stringify(mensaje));
    document.getElementById("comentario").value = "";
  }
  </script>
</body>
</html>
